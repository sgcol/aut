!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).WechatJSSDK=i()}(this,(function(){var t="//res.wx.qq.com/open/js/jweixin-1.4.0.js",i=["onMenuShareTimeline","onMenuShareAppMessage"];return function(){function n(e){if(this instanceof n){this.sdkUrl=t,this.config=e||{},this.config.customUrl&&(this.sdkUrl=this.config.customUrl);var r=this.config.jsApiList;if(!r||r.length<=0)this.config.jsApiList=i;else for(var s=0,o=i.length;s<o;s++){var a=i[s];r.indexOf(a)<0&&r.push(a)}return this.debug=!!this.config.debug,this}return new n(e)}var e=n.prototype;return e.initialize=function(){return this.loadScript()},e.signSignature=function(t){var i=this,n=this.config,e=t||n,r={debug:this.debug,appId:n.appId,timestamp:e.timestamp||n.timestamp,nonceStr:e.nonceStr||n.nonceStr,signature:e.signature||n.signature,jsApiList:n.jsApiList.slice(0,n.jsApiList.length)},s=this.debug;return new Promise((function(t,n){if(!window.wx)return n(new Error("wx js not defined"));var e=window.wx;i.setOriginWx(),e.config(r),e.ready((function(){console.log("sign signature finished..."),i.setOriginWx(),t(i)})),e.error((function(t){s&&alert("sign error: "+JSON.stringify(t)),i.setOriginWx(),n(t)}))}))},e.loadScript=function(){var t=this;return new Promise((function(i,n){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.onload=function(){console.log("Wechat script loaded successfully!"),t.signSignature().then((function(t){i(t)})).catch((function(t){n(t)}))},e.onerror=function(i){console.error("Failed to load wechat script!"),console.error(i),t.debug&&alert("Cannot load wechat script!"),n(i)};var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(e,r),e.src=t.sdkUrl}))},e.shareOnMoment=function(t){return t?this.callWechatApi("onMenuShareTimeline",t):this},e.shareOnChat=function(t){return t?this.callWechatApi("onMenuShareAppMessage",t):this},e.callWechatApi=function(t,i,n){if(!t)return this;var e=this.debug;if(this.config.jsApiList.indexOf(t)<0)return e&&alert("the wechat api ["+t+"] you call was not registered, \npls add the api into your [jsApiList] config"),this;var r=this.getOriginalWx()[t];return r&&"function"==typeof r?(r(i,n),this):(e&&alert("no such api ["+t+"] found!"),this)},e.getOriginalWx=function(){return this.wx||window.wx},e.setOriginWx=function(){return this.wx||(this.wx=window.wx),this},n}()}));
